<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Mini-Militia Inspired Game</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
</head>
<body>
<script>
class MainScene extends Phaser.Scene {
  constructor() {
    super('MainScene');
  }

  preload() {
    let g = this.make.graphics({x: 0, y: 0, add: false});

    // Player
    g.fillStyle(0x00ffcc, 1).fillCircle(16, 16, 16);
    g.generateTexture('player', 32, 32);

    // Enemy
    g.clear().fillStyle(0xff3333, 1).fillCircle(16, 16, 16);
    g.generateTexture('enemy', 32, 32);

    // Bullet
    g.clear().fillStyle(0xffff00, 1).fillCircle(4, 4, 4);
    g.generateTexture('bullet', 8, 8);

    // Particle (explosion)
    g.clear().fillStyle(0xffa500, 1).fillCircle(2, 2, 2);
    g.generateTexture('particle', 4, 4);

    // Health kit
    g.clear().fillStyle(0x00ff00, 1).fillRect(0, 0, 20, 20);
    g.generateTexture('healthkit', 20, 20);

    // Obstacle
    g.clear().fillStyle(0x555555, 1).fillRect(0, 0, 80, 20);
    g.generateTexture('obstacle', 80, 20);
  }

  create() {
    this.startText = this.add.text(400, 300, 'Press P to Play', {
      fontSize: '40px', fill: '#ffffff', fontFamily: 'Arial Black'
    }).setOrigin(0.5);

    this.input.keyboard.on('keydown-P', () => {
      this.startText.destroy();
      this.startGame();
    });
  }

  startGame() {
    // --- Player ---
    this.player = this.physics.add.sprite(400, 300, 'player').setCollideWorldBounds(true);

    // --- Groups ---
    this.bullets = this.physics.add.group();
    this.enemies = this.physics.add.group();
    this.healthkits = this.physics.add.group();

    // --- Particles ---
    this.particles = this.add.particles('particle');

    // --- Controls ---
    this.cursors = this.input.keyboard.createCursorKeys();
    this.keys = this.input.keyboard.addKeys({
      W: Phaser.Input.Keyboard.KeyCodes.W,
      A: Phaser.Input.Keyboard.KeyCodes.A,
      S: Phaser.Input.Keyboard.KeyCodes.S,
      D: Phaser.Input.Keyboard.KeyCodes.D,
      SPACE: Phaser.Input.Keyboard.KeyCodes.SPACE
    });

    // --- HUD ---
    this.coins = 0;
    this.health = 100;
    this.coinText = this.add.text(16, 16, 'üí∞ Coins: 0', { fontSize: '20px', fill: '#ff0' });
    this.healthText = this.add.text(16, 40, '‚ù§Ô∏è Health: 100', { fontSize: '20px', fill: '#ff4444' });

    // --- Obstacles ---
    this.obstacles = this.physics.add.staticGroup();
    this.obstacles.create(300, 200, 'obstacle');
    this.obstacles.create(500, 400, 'obstacle').setRotation(Math.PI/2);

    this.physics.add.collider(this.player, this.obstacles);
    this.physics.add.collider(this.enemies, this.obstacles);

    // --- Enemy spawn ---
    this.time.addEvent({ delay: 2000, callback: () => this.spawnEnemy(), loop: true });

    // --- Health kit spawn ---
    this.time.addEvent({ delay: 10000, callback: () => this.spawnHealthkit(), loop: true });

    // --- Collisions ---
    this.physics.add.overlap(this.bullets, this.enemies, (bullet, enemy) => {
      bullet.destroy(); enemy.destroy();
      this.particles.createEmitter({
        speed: { min: -200, max: 200 },
        lifespan: 400,
        quantity: 15,
        scale: { start: 0.6, end: 0 }
      }).explode(15, enemy.x, enemy.y);
      this.coins += 10;
      this.coinText.setText('üí∞ Coins: ' + this.coins);
    });

    this.physics.add.overlap(this.player, this.enemies, (player, enemy) => {
      enemy.destroy();
      this.takeDamage(10);
    });

    this.physics.add.overlap(this.player, this.healthkits, (player, kit) => {
      kit.destroy();
      this.health = Math.min(this.health + 20, 100);
      this.healthText.setText('‚ù§Ô∏è Health: ' + this.health);
    });
  }

  spawnEnemy() {
    const x = Phaser.Math.Between(50, 750);
    const y = Phaser.Math.Between(50, 550);
    const enemy = this.enemies.create(x, y, 'enemy');
    enemy.setCircle(16);
  }

  spawnHealthkit() {
    const x = Phaser.Math.Between(50, 750);
    const y = Phaser.Math.Between(50, 550);
    this.healthkits.create(x, y, 'healthkit');
  }

  shootBullet() {
    const pointer = this.input.activePointer;
    const bullet = this.bullets.create(this.player.x, this.player.y, 'bullet');
    this.physics.moveTo(bullet, pointer.worldX, pointer.worldY, 400);
  }

  takeDamage(amount) {
    this.health -= amount;
    if (this.health < 0) this.health = 0;
    this.healthText.setText('‚ù§Ô∏è Health: ' + this.health);
    if (this.health <= 0) this.gameOver();
  }

  gameOver() {
    this.player.destroy();
    this.enemies.clear(true, true);
    this.add.text(400, 300, 'üíÄ GAME OVER üíÄ', {
      fontSize: '50px', fill: '#ff0000', fontFamily: 'Arial Black'
    }).setOrigin(0.5);
  }

  update() {
    if (!this.player) return;

    // Movement
    this.player.setVelocity(0);
    if (this.cursors.left.isDown || this.keys.A.isDown) this.player.setVelocityX(-200);
    if (this.cursors.right.isDown || this.keys.D.isDown) this.player.setVelocityX(200);
    if (this.cursors.up.isDown || this.keys.W.isDown) this.player.setVelocityY(-200);
    if (this.cursors.down.isDown || this.keys.S.isDown) this.player.setVelocityY(200);

    // Shooting
    if (Phaser.Input.Keyboard.JustDown(this.keys.SPACE)) {
      this.shootBullet();
    }

    // Enemy chasing
    this.enemies.children.iterate(enemy => {
      if (enemy) {
        this.physics.moveToObject(enemy, this.player, 100);
      }
    });
  }
}

const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  backgroundColor: '#101820',
  physics: { default: 'arcade', arcade: { debug: false } },
  scene: MainScene
};
new Phaser.Game(config);
</script>
</body>
</html>
tml>
