<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MiniHack Game (Phaser)</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
  <style>
    body { margin:0; background:#000; }
    canvas { display:block; margin:auto; }
  </style>
</head>
<body>
<script>
class MenuScene extends Phaser.Scene {
  constructor() { super("MenuScene"); }
  create() {
    this.add.text(300,100,"ðŸš€ MiniHack",{fontSize:"40px",fill:"#fff"});
    this.add.text(300,200,"Press P to Play",{fontSize:"20px",fill:"#0f0"});
    this.input.keyboard.on("keydown-P",()=> 
      this.scene.start("GameScene",{character:"blue",terrain:"desert"})
    );
  }
}

class GameScene extends Phaser.Scene {
  constructor(){ super("GameScene"); }
  init(data){ this.character = data.character; this.terrain = data.terrain; }

  create() {
    // Background
    if(this.terrain==="desert") this.cameras.main.setBackgroundColor("#c2b280");
    else this.cameras.main.setBackgroundColor("#228b22");

    // Player (use graphics object + physics body)
    this.player = this.add.rectangle(400,300,40,40,
      this.character==="red"?0xff0000:0x00ffff);
    this.physics.add.existing(this.player); 
    this.player.body.setCollideWorldBounds(true);

    // Controls
    this.cursors = this.input.keyboard.createCursorKeys();
    this.space = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

    // Groups
    this.bullets = this.physics.add.group();
    this.enemies = this.physics.add.group();

    // Spawn enemies
    for(let i=0;i<3;i++) this.spawnEnemy();

    // HUD
    this.health = 100;
    this.coins = 0;
    this.hudHealth = this.add.text(10,10,"â¤ï¸ 100",{fontSize:"20px",fill:"#fff"}).setScrollFactor(0);
    this.hudCoins = this.add.text(10,40,"ðŸ’° 0",{fontSize:"20px",fill:"#FFD700"}).setScrollFactor(0);

    // Wallet panel (fixed UI)
    this.walletPanel = this.add.rectangle(620, 10, 170, 70, 0x222222, 0.7).setOrigin(0,0).setScrollFactor(0);
    this.walletAddr = this.add.text(630,20,"0x123...abc",{fontSize:"14px",fill:"#fff"}).setScrollFactor(0);
    this.walletBalance = this.add.text(630,40,"Balance: 0",{fontSize:"14px",fill:"#FFD700"}).setScrollFactor(0);

    // Collisions
    this.physics.add.overlap(this.bullets, this.enemies, (bullet,enemy)=>{
      bullet.destroy();
      enemy.destroy();
      this.earnCoins(10);
      this.spawnEnemy();
    });
  }

  update() {
    const speed=200;
    this.player.body.setVelocity(0);

    if(this.cursors.left.isDown) this.player.body.setVelocityX(-speed);
    if(this.cursors.right.isDown) this.player.body.setVelocityX(speed);
    if(this.cursors.up.isDown) this.player.body.setVelocityY(-speed);
    if(this.cursors.down.isDown) this.player.body.setVelocityY(speed);

    // Shooting
    if(Phaser.Input.Keyboard.JustDown(this.space)){
      let bullet = this.add.rectangle(this.player.x,this.player.y,10,5,0xffff00);
      this.physics.add.existing(bullet);
      bullet.body.velocity.x = 300; // shoots right
      this.bullets.add(bullet);
    }

    // Enemies chase player
    this.enemies.children.iterate((enemy)=>{
      if(enemy && enemy.body){
        this.physics.moveToObject(enemy, this.player, 100);
      }
    });
  }

  spawnEnemy(){
    let x = Phaser.Math.Between(50,750);
    let y = Phaser.Math.Between(50,550);
    let enemy = this.add.rectangle(x,y,40,40,0xff0000);
    this.physics.add.existing(enemy);
    this.enemies.add(enemy);
  }

  earnCoins(amount){
    this.coins += amount;
    this.hudCoins.setText("ðŸ’° " + this.coins);
    this.walletBalance.setText("Balance: " + this.coins);
  }
}

const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  backgroundColor: "#000",
  physics: { default: "arcade", arcade: { debug: false } },
  scene: [MenuScene, GameScene]
};
new Phaser.Game(config);
</script>
</body>
</html>
